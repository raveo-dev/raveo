---
import Layout from '../layouts/Layout.astro';
import CmsImage from '../components/CmsImage.astro';
import { renderLexical } from '../utils/lexical';

const { slug } = Astro.params;

const page = Astro.locals.pages.find(p => p.slug === slug) ?? null;

if (!page) {
  return Astro.redirect('/404');
}

const hero = page.hero ?? null;
const seoTitle = page.seo?.title ?? page.title;
const seoDescription = page.seo?.description ?? '';
const noIndex = page.seo?.noIndex ?? false;
---

<Layout title={seoTitle} description={seoDescription} noIndex={noIndex}>
  {hero && (
    <section class="relative min-h-[40vh] flex items-center justify-center overflow-hidden bg-black">
      {hero.image?.url && (
        <CmsImage
          src={hero.image.url}
          alt={hero.image.alt ?? ''}
          width={hero.image.width ?? 1920}
          height={hero.image.height ?? 1080}
          class="absolute inset-0 opacity-60"
          loading="eager"
          cover
        />
      )}
      <div class="relative z-10 text-center px-6 max-w-3xl mx-auto">
        {hero.heading && (
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">{hero.heading}</h1>
        )}
        {hero.subheading && (
          <p class="text-lg md:text-xl text-white/80">{hero.subheading}</p>
        )}
      </div>
    </section>
  )}

  {!hero && (
    <section class="py-12 px-6">
      <div class="max-w-3xl mx-auto">
        <h1 class="text-4xl font-bold mb-4">{page.title}</h1>
      </div>
    </section>
  )}

  <section class="py-12 px-6">
    <div class="max-w-3xl mx-auto prose prose-gray max-w-none">
      <Fragment set:html={renderLexical(page.content)} />
    </div>
  </section>
</Layout>