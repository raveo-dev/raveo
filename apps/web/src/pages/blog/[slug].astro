---
import Layout from '../../layouts/Layout.astro';

const { slug } = Astro.params;

const post = Astro.locals.posts.find(p => p.slug === slug) ?? null;

if (!post) {
  return Astro.redirect('/404');
}

const { siteSettings } = Astro.locals;
const baseUrl = Astro.site?.toString().replace(/\/$/, '') ?? '';

const schema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: post.title,
  description: post.seo?.description ?? post.excerpt ?? '',
  datePublished: post.publishedDate ?? '',
  dateModified: post.publishedDate ?? '',
  author: {
    '@type': 'Organization',
    name: siteSettings?.siteName ?? 'Raveo',
  },
  publisher: {
    '@type': 'Organization',
    name: siteSettings?.siteName ?? 'Raveo',
  },
  url: `${baseUrl}/blog/${post.slug}`,
};
---

<Layout title={post.title} description={post.seo?.description ?? post.excerpt ?? undefined} schema={schema}>
  <article class="max-w-3xl mx-auto">
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4">{post.title}</h1>
      {post.excerpt && (
        <p class="text-xl text-gray-600 mb-4">{post.excerpt}</p>
      )}
      <div class="flex gap-4 text-sm text-gray-400">
        {post.publishedDate && (
          <time>{new Date(post.publishedDate).toLocaleDateString()}</time>
        )}
        {post.categories && post.categories.length > 0 && (
          <span>{post.categories.map(c => c.name).join(', ')}</span>
        )}
      </div>
    </header>
    <div class="prose prose-gray max-w-none">
      <p class="text-gray-500 italic">Rich text rendering coming soon.</p>
    </div>
  </article>
</Layout>