---
import Layout from "../layouts/Layout.astro";
import CmsImage from "../components/CmsImage.astro";
import { renderLexical } from "../utils/lexical";

const homePage = Astro.locals.pages.find((p) => p.slug === "home") ?? null;
const contentHtml = renderLexical(homePage?.content);
const { siteSettings } = Astro.locals;

const hero = homePage?.hero ?? null;
const seoTitle = homePage?.seo?.title ?? homePage?.title ?? "Raveo";
const seoDescription = homePage?.seo?.description ?? "";
const baseUrl = Astro.site?.toString().replace(/\/$/, '') ?? '';

const schema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: siteSettings?.siteName ?? 'Raveo',
  description: seoDescription,
  url: baseUrl,
};
---

<Layout title={seoTitle} description={seoDescription} schema={schema}>
  {hero ? (
    <section class="relative min-h-[60vh] flex items-center justify-center overflow-hidden bg-black">
      {hero.image?.url && (
        <CmsImage
          src={hero.image.url}
          alt={hero.image.alt ?? ""}
          width={hero.image.width ?? 1920}
          height={hero.image.height ?? 1080}
          class="absolute inset-0 opacity-60"
          loading="eager"
          cover
        />
      )}
      <div class="relative z-10 text-center px-6 max-w-3xl mx-auto">
        {hero.heading && (
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">{hero.heading}</h1>
        )}
        {hero.subheading && (
          <p class="text-lg md:text-xl text-white/80">{hero.subheading}</p>
        )}
      </div>
    </section>
  ) : (
    <section class="min-h-[60vh] flex items-center justify-center bg-black">
      <div class="text-center px-6">
        <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
          {Astro.locals.siteSettings?.siteName ?? "Raveo"}
        </h1>
        <p class="text-lg text-white/80">
          {Astro.locals.siteSettings?.siteDescription ?? ""}
        </p>
      </div>
    </section>
  )}

  {contentHtml && (
    <section class="py-12 px-6">
      <div class="max-w-3xl mx-auto prose prose-gray max-w-none">
        <Fragment set:html={contentHtml} />
      </div>
    </section>
  )}
</Layout>